cluster_name: h100
max_workers: 0
idle_timeout_minutes: 5

provider:
  type: external
  module: brr.nebius.node_provider.NebiusNodeProvider
  project_id: "{{NEBIUS_PROJECT_ID}}"
  filesystem_id: "{{NEBIUS_FILESYSTEM_ID}}"
  # cache_stopped_nodes: true  # Stop (not delete) on scale-down for faster restart. Costs disk fees while stopped.

auth:
  ssh_user: ubuntu
  ssh_private_key: {{NEBIUS_SSH_KEY}}

head_node_type: ray.head.default

available_node_types:
  ray.head.default:
    resources:
      CPU: 16
      GPU: 1
    node_config:
      platform_id: gpu-h100-sxm
      preset_id: 1gpu-16vcpu-200gb
      image_family: ubuntu22.04-cuda12
      subnet_id: "{{NEBIUS_SUBNET_ID}}"
      disk_size_gb: 50
      disk_type: network-ssd-nonreplicated

head_start_ray_commands:
    - source $HOME/.venv/bin/activate && ray stop
    - source $HOME/.venv/bin/activate && ray start --head --port=6379 --object-manager-port=8076 --autoscaling-config=~/ray_bootstrap_config.yaml --dashboard-host=0.0.0.0

worker_start_ray_commands:
    - source $HOME/.venv/bin/activate && ray stop
    - source $HOME/.venv/bin/activate && ray start --address=$RAY_HEAD_IP:6379 --object-manager-port=8076
